# 配置会话保持

如果您的非网站业务接入DDoS高防后存在登录超时需要重新登录、上传数据断开等问题，您可以开启会话保持功能。会话保持可以在指定的时间范围内将同一客户端的请求转发至同一台后端服务器上。本文介绍了为端口转发规则配置会话保持的方法。

已在端口接入中配置非网站业务端口转发规则。更多信息，请参见[添加规则](/intl.zh-CN/DDoS高防（新BGP&国际）用户指南/接入DDoS高防/端口接入/添加规则.md)。

## 开启会话保持

1.  登录[DDoS高防控制台](https://yundun.console.aliyun.com/?p=ddoscoo)。

2.  在顶部菜单栏左上角处，选择服务所在地域：

    -   **中国内地**：选择该地域将跳转到**DDoS高防（新BGP）**控制台。
    -   **非中国内地**：选择该地域将跳转到**DDoS高防（国际）**控制台。
    您可以通过切换地域分别管理和配置DDoS高防（新BGP）和DDoS高防（国际）实例。在使用DDoS高防服务时，请确认您已选择正确的地域。

3.  在左侧导航栏，选择**接入管理** \> **端口接入**。

4.  在**端口接入**页面，选择DDoS高防实例，并定位到要操作的转发规则，单击**会话保持**列下的**配置**。

    **说明：** 您也可以在高防实例下使用批量操作，批量修改会话和健康检查配置。具体操作，请参见[批量添加会话和健康检查配置](#section_qm6_zi5_600)。

    ![会话保持](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2732247061/p69479.png)

5.  在**会话保持**对话框，设置**超时时间**（单位：秒，取值范围：30~3600），并单击**设置超时时间并开启**。

    ![回话保持](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2732247061/p49646.png)

    成功开启会话保持后，转发规则的**会话保持**状态会更新为**已开启**。

    ![已开启](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2732247061/p189964.png)


## 批量添加会话和健康检查配置

1.  登录[DDoS高防控制台](https://yundun.console.aliyun.com/?p=ddoscoo)。

2.  在顶部菜单栏左上角处，选择服务所在地域：

    -   **中国内地**：选择该地域将跳转到**DDoS高防（新BGP）**控制台。
    -   **非中国内地**：选择该地域将跳转到**DDoS高防（国际）**控制台。
    您可以通过切换地域分别管理和配置DDoS高防（新BGP）和DDoS高防（国际）实例。在使用DDoS高防服务时，请确认您已选择正确的地域。

3.  在左侧导航栏，选择**接入管理** \> **端口接入**。

4.  在**端口接入**页面，选择要操作的DDoS高防实例，并在规则列表下方选择**批量操作** \> **添加会话/健康检查配置**。

    ![添加会话和健康检查配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5302247061/p190055.png)

5.  在**添加会话/健康检测配置**对话框，按照格式要求输入要添加的会话保持和健康检查配置内容，并单击**确定**。

    ![添加会话/健康配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5302247061/p69485.png)

    **说明：** 您也可以先批量导出当前会话和健康检查配置，在导出的TXT文件中统一调整后再将内容复制粘贴进来。更多信息，请参见[批量导出](/intl.zh-CN/DDoS高防（新BGP&国际）用户指南/接入DDoS高防/端口接入/批量导出.md)。

    会话保持、健康检查配置的格式要求如下：

    -   每行对应一条转发规则的会话保持和健康配置。
    -   每条会话保持和健康检查配置从左到右包含以下字段：转发协议端口、转发协议（取值：TCP、HTTP、UDP）、会话保持超时时间（单位：秒，取值范围：30~3600）、健康检查类型、检查端口、检查超时时间、检查间隔、不健康阈值、健康阈值、检查路径（转发协议为HTTP时必选）、域名（转发协议为HTTP时可选）。字段间以空格分隔。

        关于不同字段的详细说明，请参见[\#d8e32](#d8e32)。

    -   转发协议端口必须是已添加规则的端口。
    -   转发规则协议为UDP时，建议配置UDP健康检查。转发规则协议为TCP时，建议配置TCP（四层）或HTTP（七层）健康检查。
    -   转发协议为HTTP时，检查路径必选，域名可选。

